/*!
 * JSGlib 2.2 (minified), JavaScript Library
 * http://jsglib.no-ip.org/
 *
 * Copyright 2011-2012, Adrien Guéret
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * 
 * Date: 25/10/2012
 */
function Game(){alert("Il est inutile d'instancier la classe Game !")}Game.elements=[];Game.activeElements=[];Game.tilesAndElements=[];Game.end=!0;Game.lastId=1;Game.canvas=null;Game.context2D=null;Game.canvasBuffer=null;Game.contextBuffer=null;Game.isPause=!1;Game.rooms=[];Game.room=null;Game.infoGameBuilder=!0;Game.currentStep=0;Game.images={};Game.sounds={};Game.soundsPlaying=[];Game.soundsActivated=!0;Game.zIndex=!1;Game.speed=100;Game.mouse_x=0;Game.mouse_y=0;Game.changeRoom=!1; Game.keyspressed=[];Game.translations={};Game.stopPropagation=!1;Game.isFullscreen=!1;Game.MAX_ZINDEX=1;Game.KEY_TAB=9;Game.KEY_ENTER=13;Game.KEY_SHIFT=16;Game.KEY_CONTROL=17;Game.KEY_ALT=18;Game.KEY_CAPS_LOCK=20;Game.KEY_SPACE=32;Game.KEY_LEFT=37;Game.KEY_UP=38;Game.KEY_RIGHT=39;Game.KEY_DOWN=40;Game.KEY_A=65;Game.KEY_B=66;Game.KEY_C=67;Game.KEY_D=68;Game.KEY_E=69;Game.KEY_F=70;Game.KEY_G=71;Game.KEY_H=72;Game.KEY_I=73;Game.KEY_J=74;Game.KEY_K=75;Game.KEY_L=76;Game.KEY_M=77;Game.KEY_N=78; Game.KEY_O=79;Game.KEY_P=80;Game.KEY_Q=81;Game.KEY_R=82;Game.KEY_S=83;Game.KEY_T=84;Game.KEY_U=85;Game.KEY_V=86;Game.KEY_W=87;Game.KEY_X=88;Game.KEY_Y=89;Game.KEY_Z=90;var lang=navigator.userLanguage?navigator.userLanguage:navigator.language,t=lang.indexOf("-");Game.userLang=-1<t?lang.substr(0,t):lang;Game.defaultLang="en"; window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)});Game.refreshDrawing=function(){Game.canvas.width=Game.canvas.width;Game.context2D.drawImage(Game.canvasBuffer,0,0,Game.canvas.width,Game.canvas.height);Game.canvasBuffer.width=Game.canvasBuffer.width}; Game.step=function(){Game.currentStep++;if(!Game.isPause){Game.room.display();if(Game.zIndex){var a=function(a,b){return a.zIndex-b.zIndex};Game.elements.sort(a);Game.activeElements.sort(a);Game.tilesAndElements=Game.elements.concat(Game.room.tiles);Game.tilesAndElements.sort(a);Game.zIndex=!1}for(var a=0,b=Game.tilesAndElements.length;a<b;a++)if(Game.tilesAndElements[a].types){if(Game.manageElements(Game.tilesAndElements[a]),Game.changeRoom){Game.changeRoom=!1;break}}else{var c=Game.tilesAndElements[a]; c.image.complete&&(c.x>Game.room.view_x-c.w&&c.x<Game.room.view_x+Game.room.view_w&&c.y>Game.room.view_y-c.h&&c.y<Game.room.view_y+Game.room.view_h)&&Game.contextBuffer.drawImage(c.image,c.posXImage,c.posYImage,c.w,c.h,c.x-Math.round(Game.room.view_x),c.y-Math.round(Game.room.view_y),c.w,c.h)}}Game.end?Game.gameEnd():(window.requestAnimationFrame(Game.refreshDrawing),setTimeout(Game.step,33/(Game.speed/100)))}; Game.manageElements=function(a){if(a&&(a.x>=Game.room.view_w+Game.room.view_x||a.y>=Game.room.view_h+Game.room.view_y||a.x<=Game.room.view_x-a.sprite.width||a.y<=Game.room.view_y-a.sprite.height?a.eventOutsideView():a.eventInsideView(),a.active)){if(a.x>=Game.room.width||a.y>=Game.room.height||a.x<=-a.sprite.width||a.y<=-a.sprite.height)a.eventOutsideRoom(),a.switchPositionWhenLeave&&a.switchPositionWhenOutsideRoom();a.xprev=a.x;a.yprev=a.y;if(void 0!=a.moveToPointCallBack.f){var b=a.moveToPointCallBack; if((b.fromLeft&&Math.floor(a.x)>=b.x||!b.fromLeft&&Math.floor(a.x)<=b.x)&&(b.fromTop&&Math.floor(a.y)>=b.y||!b.fromTop&&Math.floor(a.y)<=b.y)){var c=b.f;a.x=b.x;a.y=b.y;a.moveToPointCallBack={};c.apply(a)}}a.eventStartStep(Game.currentStep);a.move();a.sprite.changeImage()&&!1===a.eventEndAnimation()&&(a.sprite.imagespeed=0,a.sprite.imageindex=a.sprite.tiles.length-1);for(b=1;10>=b;b++)if(0<a["alarm"+b]&&0==--a["alarm"+b])a["eventAlarm"+b]();a.eventStep(Game.currentStep);a.display();!a.solid&&a.checkForCollisions&& Game.checkCollisions(a);a.eventEndStep(Game.currentStep)}};Game.checkCollisions=function(a){for(var b=a.checkCollisions(),c=0,g=b.length;c<g;c++)b[c]&&a.eventCollisionWith(b[c])}; Game.run=function(){if(0==Game.rooms.length)return alert("Impossible de lancer le jeu : il ne poss\u00e8de aucune Room !\nVeuillez lui en ajoutant via la m\u00e9thode Game.setRooms()."),!1;Game.canvas.style.overflow="hidden";if("static"==Game.canvas.style.position||0==Game.canvas.style.position.length)Game.canvas.style.position="relative";Game.canvas.onmousemove=function(a){a.x?(Game.mouse_x=a.offsetX,Game.mouse_y=a.offsetY):(Game.mouse_x=a.layerX,Game.mouse_y=a.layerY);Game.isFullscreen&&(Game.mouse_x/= parseFloat(Game.canvas.getAttribute("data-jsglib-ratioWidth"),10),Game.mouse_y/=parseFloat(Game.canvas.getAttribute("data-jsglib-ratioHeight"),10))};Game.canvas.onmousedown=function(a){Game.canvas.onmousemove(a);for(var b=0,d=Game.activeElements.length;b<d;b++)Game.activeElements[b]&&Game.activeElements[b].eventMouseDown(0==a.button?37:39)};Game.canvas.onmouseup=function(a){Game.canvas.onmousemove(a);var b=!1,a=0==a.button?37:39,d;Game.stopPropagation=!1;for(i=Game.activeElements.length-1;0<=i&&(!Game.activeElements[i]|| !(d=Game.activeElements[i].eventMouseUp(a),!b&&!1===d&&(b=!0),Game.stopPropagation));i--);Game.stopPropagation=!1;for(i=Game.activeElements.length-1;0<=i&&(!Game.activeElements[i]||!(d=Game.activeElements[i].eventClick(a),!b&&!1===d&&(b=!0),Game.stopPropagation));i--);Game.canvas.oncontextmenu=b?function(){return!1}:null};document.onkeydown=function(a){a||(a=window.event);var a=a.which?a.which:a.keyCode,b=Game.isKeyPressed(a),d=!1,h;b||Game.keyspressed.push(a);for(var j=0,e=Game.activeElements.length;j< e;j++)Game.activeElements[j]&&(b||(h=Game.activeElements[j].eventKeyDown(a),!d&&!1===h&&(d=!0)),Game.activeElements[j]&&(h=Game.activeElements[j].eventKeyPressed(a)),!d&&!1===h&&(d=!0));if(d)return!1};document.onkeyup=function(a){a||(a=window.event);for(var a=a.which?a.which:a.keyCode,b=[],d=0,h=Game.keyspressed.length;d<h;d++)Game.keyspressed[d]!=a&&b.push(Game.keyspressed[d]);Game.keyspressed=b;d=0;for(h=Game.activeElements.length;d<h;d++)Game.activeElements[d]&&Game.activeElements[d].eventKeyUp(a)}; Game.room=Game.rooms[0];var a=Game.canvas.parentNode;Game.canvasBuffer=document.createElement("canvas");Game.canvasBuffer.style.display="none";a.appendChild(Game.canvasBuffer);Game.contextBuffer=Game.canvasBuffer.getContext("2d");if(Game.infoGameBuilder){var b=document.createElement("span");b.innerHTML='Powered by <a href="http://jsglib.no-ip.org/">JSGlib</a>.';b.id="infoGameBuilder";b.style.textAlign="right";b.style.display="block";b.style.width=Game.room.width+"px";b.style.margin="auto";b.style.fontSize= "12px";a.lastchild==Game.canvas?a.appendChild(b):a.insertBefore(b,Game.canvas.nextSibling)}Game.gameStart();Game.room.start();Game.end=!1;Game.step()}; Game.centerResizeHandler=function(){var a=window.getComputedStyle(Game.canvas),b=parseInt(Game.canvas.getAttribute("data-jsglib-width"),10),c=parseInt(Game.canvas.getAttribute("data-jsglib-height"),10),g=window.innerWidth>window.innerHeight,d=b>c;propWellSized=g?"height":"width";propToChange=g?"width":"height";if((d&&g||!d&&!g)&&window.innerWidth/window.innerHeight<b/c)propWellSized=g?"width":"height",propToChange=g?"height":"width";b=parseInt(Game.canvas.getAttribute("data-jsglib-"+propToChange), 10);Game.canvas.style[propWellSized]="100%";b*=parseInt(a[propWellSized],10)/parseInt(Game.canvas.getAttribute("data-jsglib-"+propWellSized),10);Game.canvas.style[propToChange]=b+"px";"height"==propWellSized?(Game.canvas.style.left=window.innerWidth/2-parseInt(a.width,10)/2+"px",Game.canvas.style.top=0):(Game.canvas.style.top=window.innerHeight/2-parseInt(a.height,10)/2+"px",Game.canvas.style.left=0)}; Game.backgroundResizeHandler=function(){var a=window.getComputedStyle(Game.canvas),b=a.backgroundImage.substring(a.backgroundImage.indexOf("(")+1,a.backgroundImage.lastIndexOf(")")).replace(/"/gi,"");if(0<b.length){var c=new Image;c.src=b;Game.canvas.setAttribute("data-jsglib-backgroundImageWidth",c.width);Game.canvas.setAttribute("data-jsglib-backgroundImageHeight",c.height)}var g=parseInt(Game.canvas.getAttribute("data-jsglib-width"),10),d=parseInt(Game.canvas.getAttribute("data-jsglib-height"), 10),b=parseInt(Game.canvas.getAttribute("data-jsglib-backgroundImageWidth"),10),c=parseInt(Game.canvas.getAttribute("data-jsglib-backgroundImageHeight"),10),h=parseInt(a.width,10),a=parseInt(a.height,10),g=h/g,a=a/d;Game.canvas.setAttribute("data-jsglib-ratioWidth",g);Game.canvas.setAttribute("data-jsglib-ratioHeight",a);Game.canvas.style.backgroundSize=b*g+"px "+c*a+"px"}; Game.addClass=function(a){window[a.name]=function(b,c){a.parent=void 0==a.parent?["Element"]:a.parent;"string"==typeof a.parent&&(a.parent=[a.parent]);a["abstract"]=void 0==a["abstract"]?!1:a["abstract"];for(var g=0,d=a.parent.length;g<d;g++)window[a.parent[g]].call(this);if(void 0==window[a.name].isLoaded){g=0;for(d=a.parent.length;g<d;g++)for(var h in window[a.parent[g]].prototype)window[a.name].prototype[h]=window[a.parent[g]].prototype[h],this[h]=window[a.parent[g]].prototype[h];for(h in a)"name"!= h&&("parent"!=h&&"abstract"!=h)&&(window[a.name].prototype[h]=a[h],this[h]=a[h]);window[a.name].isLoaded=!0;window[a.name]["abstract"]=a["abstract"]}this.types.push(a.name);this.x=parseInt(b,10);this.xstart=parseInt(b,10);this.y=parseInt(c,10);this.ystart=parseInt(c,10);this.id=Game.lastId++;if(!isNaN(this.x)){h=["Element"];g=0;for(d=this.types.length;g<d;g++)h.push(this.types[g]);this.types=h;Game.zIndex=!0}};window[a.name].toString=function(){return a.name}}; Game.loadAndRun=function(a,b,c){Game.canvas=document.getElementById(a);if(null==Game.canvas)return alert("La zone de jeu indiqu\u00e9e n'existe pas !"),!1;Element["abstract"]=!0;Game.context2D=Game.canvas.getContext("2d");Game.context2D.textBaseline="top";Game.canvas.width="500";Game.canvas.height="30";Game.context2D.fillStyle="#000";Game.context2D.font="bold 20px Calibri";Game.context2D.fillText("0%",250,20);var g=0,d=-1,h=0,b=void 0==b?{}:b,c=void 0==c?{}:c,j;for(j in b)g++;for(j in c)g++;g+=Game.rooms.length; if(0<g){var e=function(){d++;Game.canvas.height="30";h=parseInt(100*d/g,10);Game.context2D.fillStyle="#ff0000";Game.context2D.rect(0,0,500*h/100,30);Game.context2D.fill();Game.context2D.fillStyle="#000";Game.context2D.font="bold 20px Calibri";Game.context2D.fillText(h+"%",250,20);d==g&&setTimeout(function(){Game.run()},500)};e();j=0;for(a=Game.rooms.length;j<a;j++){var k=Game.rooms[j];k.path?Game.ajax({url:k.path,type:"GET",async:!1,dataType:"XML",onSuccess:function(a){k.xml=a.documentElement;k.width= parseInt(k.xml.getAttribute("width"),10);0==k.view_w&&(k.view_w=k.width);k.height=parseInt(k.xml.getAttribute("height"),10);0==k.view_h&&(k.view_h=k.height);k.backgroundImage=k.xml.getAttribute("background");e()},onError:function(){alert("Erreur de chargement du fichier de niveau : "+k.path);return!1}}):e()}for(j in c){var a=c[j],f=document.createElement("audio"),n=Game.canvas.parentNode;f.preload=!0;n.lastchild==Game.canvas?n.appendChild(f):n.insertBefore(f,Game.canvas.nextSibling);for(var l in a){var n= document.createElement("source"),m="";switch(a[l].substring(a[l].lastIndexOf(".")+1)){case "mp3":m="audio/mpeg";break;case "wav":m="audio/wav";break;case "ogg":m="audio/ogg"}0<f.canPlayType(m).length&&(n.src=a[l],f.appendChild(n))}Game.sounds[j]=f;e()}for(j in b)c=new Image,c.src=b[j],Game.images[j]=c,c.onload=e}else Game.run()};Game.getImage=function(a){return void 0!=Game.images[a]?Game.images[a]:null}; Game.getMouse=function(a){a=null==a?!0:a;return[a?Game.mouse_x:Game.mouse_x+Game.room.view_x,a?Game.mouse_y:Game.mouse_y+Game.room.view_y]};Game.setRooms=function(a){Game.rooms=a;for(var b=0,a=a.length;b<a;b++)Game.rooms[b].id=b};Game.goToNextRoom=function(){var a=Game.room.id+1;Game.id>=Game.rooms.length&&(a=0);Game.room.eventEnd();Game.room=Game.rooms[a];Game.room.start()}; Game.goToPreviousRoom=function(){var a=Game.room.id-1;0>a&&(a=Game.rooms.length-1);Game.room.eventEnd();Game.room=Game.rooms[a];Game.room.start()};Game.goToRoom=function(a){Game.room.eventEnd();a instanceof Room?Game.room=a:(a=parseInt(a,10),0>a?a=0:a>=Game.rooms.length&&(a=Game.rooms.length-1),Game.room=Game.rooms[a]);Game.room.start()};Game.restartRoom=function(){Game.room.start()};Game.numberOfLines=function(a){return Game.getLinesOfText(a).length}; Game.getLinesOfText=function(a){a=Game.mergeJSON({type:"text",x:0,y:0,color:"#000000",borderLength:0,maxWidth:-1,borderColor:"#ffffff",font:"20px Calibri",opacity:100,lineHeight:20,text:""},void 0==a?{}:a);Game.contextBuffer.textBaseline="top";Game.contextBuffer.font=a.font;var b=a.text.toString().split("\n");if(0<a.maxWidth){for(var c=0,g=b.length;c<g;c++){var d="";if(Game.contextBuffer.measureText(b[c]).width>a.maxWidth){var h=-1,j="",e="",k=b[c].split(" "),f=k.length;do if(j=e,e+=k[++h]+" ",Game.contextBuffer.measureText(e).width> a.maxWidth||h==f)d+=j+"\n",e=k[h]+" ";while(h<f);b[c]=d}else b[c]+="\n"}b=b.join("").split("\n");b.splice(b.length-1)}return b}; Game.widthOfText=function(a){a=Game.mergeJSON({type:"text",x:0,y:0,color:"#000000",borderLength:0,maxWidth:-1,borderColor:"#ffffff",font:"20px Calibri",opacity:100,lineHeight:20,text:""},void 0==a?{}:a);Game.context2D.lineWidth=a.borderLength;Game.context2D.textBaseline="top";Game.context2D.font=a.font;var b=Game.context2D.measureText(a.text).width;return a.maxWidth<b&&-1<a.maxWidth?a.maxWidth:b}; Game.instanceCreate=function(a,b,c){"string"==typeof c&&(c=window[c]);if(void 0==c)return alert("Erreur <intanceCreate> : impossible d'instancier une classe non d\u00e9finie."),null;if(c["abstract"])return alert("Erreur <intanceCreate> : impossible d'instancier une classe abstraite ("+c.toString()+")."),null;a=new c(a,b);Game.elements.push(a);Game.activeElements.push(a);a.eventCreate();return a}; Game.instanceDestroy=function(a){a.eventDestroy();for(var b=0,c=Game.elements.length;b<c;b++)if(Game.elements[b].id==a.id){Game.elements.splice(b,1);break}b=0;for(c=Game.activeElements.length;b<c;b++)if(Game.activeElements[b].id==a.id){Game.activeElements.splice(b,1);break}Game.zIndex=!0};Game.instanceNumber=function(a,b){"string"==typeof a&&(a=window[a]);for(var c=0,g=b?Game.elements:Game.activeElements,d=0,h=g.length;d<h;d++)g[d].instanceOf(a)&&c++;return c}; Game.isKeyPressed=function(a){for(var b=0,c=Game.keyspressed.length;b<c;b++)if(Game.keyspressed[b]==a)return!0;return!1};Game.pause=function(a){Game.isPause?Game.gameEndPause():Game.gameStartPause();for(var b=0,c=Game.elements.length;b<c;b++)Game.elements[b].id!=a.id&&Game.elements[b].setActive(Game.isPause);Game.isPause=!Game.isPause}; Game.getInstancesIn=function(a,b,c,g,d,h,j){var e=!1,k=[],j=(void 0==j?0:j)?Game.elements:Game.activeElements,a=Math.round(1E3*a),b=Math.round(1E3*b),c=1E3*(void 0==c?1:c),g=1E3*(void 0==g?1:g),d=void 0==d?{}:d,h=void 0==h?!1:h;d.elements=void 0==d.elements?[]:d.elements;d.types=void 0==d.types?[]:d.types;var f=0,n=j.length;a:for(;f<n;f++){for(var e=j[f],l=0,m=d.types.length;l<m;l++)if(e.instanceOf(d.types[l]))continue a;l=0;for(m=d.elements.length;l<m;l++)if(e.id==d.elements[l].id)continue a;var l= e.sprite.getMask(),m=1E3*l.x,p=1E3*l.y,q=Math.round(1E3*e.x),r=Math.round(1E3*e.y);if(!(a>=q+m+1E3*l.width||a+c<=q+m||b>=r+p+1E3*l.height||b+g<=r+p)){if(h)return!0;k.push(e)}}return h?!1:k};Game.placeIsFree=function(a,b,c,g){a=Game.getInstancesIn(a,b,c,g,{},!1,!1);b=[];c=0;for(g=a.length;c<g;c++)a[c].solid&&b.push(a[c]);return 0==b.length?!0:b}; Game.getInstancesByType=function(a,b){"string"==typeof a&&(a=window[a]);for(var c=[],g=(void 0==b?0:b)?Game.elements:Game.activeElements,d=0,h=g.length;d<h;d++)g[d].instanceOf(a)&&c.push(g[d]);return c};Game.getInstanceById=function(a){for(var b=0,c=Game.elements.length;b<c;b++)if(Game.elements[b].id==a)return Game.elements[b];return null};Game.setTranslation=function(a,b,c){void 0==Game.translations[a]&&(Game.translations[a]={});Game.translations[a][b]=c}; Game.getTranslation=function(a,b,c){if(Game.translations[a]){c=void 0==c?Game.userLang:c;b=void 0==b?{}:b;Game.translations[a][c]||(c=Game.defaultLang);if(Game.translations[a][c]){var a=Game.translations[a][c],g;for(g in b)a=a.replace(RegExp(g,"g"),b[g]);return a}return"["+a+"]["+c+"]"}return"["+a+"]"};Game.getPointAfterRotation=function(a,b,c){b=(360-b)*(Math.PI/180);return{x:Math.cos(b)*(a.x-c.x)-Math.sin(b)*(a.y-c.y)+c.x,y:Math.sin(b)*(a.x-c.x)+Math.cos(b)*(a.y-c.y)+c.y}}; Game.segmentsAreInCollision=function(a,b){var c=((b.end.x-b.start.x)*(a.start.y-b.start.y)-(b.end.y-b.start.y)*(a.start.x-b.start.x))/((b.end.y-b.start.y)*(a.end.x-a.start.x)-(b.end.x-b.start.x)*(a.end.y-a.start.y)),g=((a.end.x-a.start.x)*(a.start.y-b.start.y)-(a.end.y-a.start.y)*(a.start.x-b.start.x))/((b.end.y-b.start.y)*(a.end.x-a.start.x)-(b.end.x-b.start.x)*(a.end.y-a.start.y));return 0<=c&&1>=c&&0<=g&&1>=g}; Game.random=function(a,b){if(a>b)var c=b,b=a,a=c;return Math.floor((1+b-a)*Math.random())+a};Game.mergeJSON=function(a,b,c){if(c){var c={},g;for(g in a)c[g]=a[g];for(g in b)c[g]=c[g]&&"object"==typeof c[g]?Game.mergeJSON(c[g],b[g],!0):b[g];return c}for(g in a)void 0==b[g]&&(b[g]=a[g]);return b}; Game.playSound=function(a,b,c){if(Game.soundsActivated){var b=void 0==b?!1:b,g=Game.sounds[a];void 0!=g?(0!=g.currentTime&&(g.currentTime=0),g.play(),Game.soundIsPlaying(a)||Game.soundsPlaying.push(a),g.addEventListener("ended",function h(){g.removeEventListener("ended",h,!1);for(var j=0,e=Game.soundsPlaying.length;j<e;j++)if(Game.soundsPlaying[j]==a){Game.soundsPlaying.splice(j,1);break}void 0!=c&&c();b&&(g.currentTime=0,Game.playSound(a,!0,c))},!1)):alert('Erreur <playSound> : son "'+a+'" non d\u00e9fini.')}}; Game.pauseSound=function(a,b,c){var g=Game.sounds[a];if(void 0!=g){if(Game.soundIsPlaying(a)){c=void 0==c?!1:c;void 0!=b&&(g.currentTime=0);g.pause();for(var b=0,d=Game.soundsPlaying.length;b<d;b++)if(Game.soundsPlaying[b]==a){Game.soundsPlaying.splice(b,1);break}if(c&&g.onended)g.onended()}}else alert('Erreur <Game.pauseSound()> : son "'+a+'" non d\u00e9fini.')}; Game.soundIsPlaying=function(a){if(Game.soundsActivated)for(var b=0,c=Game.soundsPlaying.length;b<c;b++)if(Game.soundsPlaying[b]==a)return!0;return!1};Game.toggleSounds=function(a){Game.soundsActivated=void 0==a?!Game.soundsActivated:a;for(var a=Game.soundsActivated?"play":"pause",b=0,c=Game.soundsPlaying.length;b<c;b++)Game.sounds[Game.soundsPlaying[b]][a]()};Game.stopSounds=function(){for(var a=0,b=Game.soundsPlaying.length;a<b;a++)Game.soundsPlaying[a]&&Game.pauseSound(Game.soundsPlaying[a],!0)}; Game.ajax=function(a){var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),c={url:"./",async:!0,type:"POST",dataType:"text",data:null,onAjaxAborted:function(){},onError:function(){},onSuccess:function(){}},g;for(g in c)"undefined"===typeof a[g]&&(a[g]=c[g]);if(b){var c="",d="POST"==a.type,h=function(a,b,d){a=void 0==d?a:d+"["+a+"]";if("object"==typeof b){d="";if(b instanceof Array)for(var c=0,g=b.length;c<g;c++)d+=h(c,b[c],a);else for(c in b)d+=h(c,b[c],a);return d}return a+ "="+b+"&"};for(g in a.data)c+=h(g,a.data[g]);c=c.substr(0,c.length-1);b.onreadystatechange=function(){if(4==b.readyState)if(200==b.status||304==b.status)a.dataType=a.dataType.toUpperCase(),a.onSuccess("JSON"==a.dataType?JSON.parse(b.responseText):"XML"==a.dataType?b.responseXML:b.responseText);else a.onError(b.statusText)};b.open(a.type,a.url+(d?"":"?"+c),a.async);d&&(b.setRequestHeader("Content-type","application/x-www-form-urlencoded"),b.setRequestHeader("Content-length",c.length));b.send(c)}else a.onAjaxAborted()}; Game.toggleFullscreen=function(a){var b=window.getComputedStyle(Game.canvas);Game.isFullscreen?(Game.isFullscreen=!1,Game.canvas.style.position=Game.canvas.getAttribute("data-jsglib-position"),Game.canvas.style.left=Game.canvas.getAttribute("data-jsglib-left"),Game.canvas.style.top=Game.canvas.getAttribute("data-jsglib-top"),Game.canvas.style.width=Game.canvas.getAttribute("data-jsglib-width"),Game.canvas.style.height=Game.canvas.getAttribute("data-jsglib-height"),Game.canvas.style.backgroundSize= Game.canvas.getAttribute("data-jsglib-backgroundSize"),window.removeEventListener("resize",Game.centerResizeHandler),window.removeEventListener("resize",Game.backgroundResizeHandler)):(Game.isFullscreen=!0,Game.canvas.setAttribute("data-jsglib-position",b.position),Game.canvas.setAttribute("data-jsglib-left",b.left),Game.canvas.setAttribute("data-jsglib-top",b.top),Game.canvas.setAttribute("data-jsglib-width",b.width),Game.canvas.setAttribute("data-jsglib-height",b.height),Game.canvas.setAttribute("data-jsglib-backgroundSize", b.backgroundSize),Game.canvas.setAttribute("data-jsglib-backgroundImageWidth",0),Game.canvas.setAttribute("data-jsglib-backgroundImageHeight",0),Game.canvas.style.position="fixed",Game.canvas.style.left=0,Game.canvas.style.top=0,a?(Game.canvas.style.width="100%",Game.canvas.style.height="100%"):(Game.centerResizeHandler(),window.addEventListener("resize",Game.centerResizeHandler)),Game.backgroundResizeHandler(),window.addEventListener("resize",Game.backgroundResizeHandler))}; Game.getDistanceBetweenPoints=function(a,b){a instanceof Array&&(a={x:a[0],y:a[1]});b instanceof Array&&(b={x:b[0],y:b[1]});return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2))};Game.gameStart=function(){};Game.gameEnd=function(){};Game.gameStartPause=function(){};Game.gameEndPause=function(){}; function Element(){this.types=!this.types?[]:this.types;this.hspeed=this.vspeed=this.yprev=this.xprev=this.ystart=this.xstart=this.y=this.x=this.id=0;this.visible=!0;this.opacity=100;this.rotate=0;this.zIndex=1;this.centerRotateY=this.centerRotateX=0;this.sprite=new Sprite(null,0,0);this.gravity=0;this.draws=[];this.active=!0;this.switchPositionWhenLeave=!1;this.collideSolid=this.checkForCollisions=!0;this.solid=!1;this.moveToPointCallBack={};this.state=this.alarm10=this.alarm9=this.alarm8=this.alarm7= this.alarm6=this.alarm5=this.alarm4=this.alarm3=this.alarm2=this.alarm1=0;void 0==Element.isLoaded&&(Element.isLoaded=!0,Element.canvasFilter=document.createElement("canvas"),Element.contextFilter=Element.canvasFilter.getContext("2d"),Element.STATE_STAND=0,Element.STATE_STAND_LEFT=1,Element.STATE_STAND_RIGHT=2,Element.STATE_STAND_UP=3,Element.STATE_STAND_UP_LEFT=4,Element.STATE_STAND_UP_RIGHT=5,Element.STATE_STAND_DOWN=6,Element.STATE_STAND_DOWN_LEFT=7,Element.STATE_STAND_DOWN_RIGHT=8,Element.STATE_MOVE= 9,Element.STATE_MOVE_RIGHT=10,Element.STATE_MOVE_LEFT=11,Element.STATE_MOVE_UP=12,Element.STATE_MOVE_UP_LEFT=13,Element.STATE_MOVE_UP_RIGHT=14,Element.STATE_MOVE_DOWN=15,Element.STATE_MOVE_DOWN_LEFT=16,Element.STATE_MOVE_DOWN_RIGHT=17,Element.STATE_HURT=18,Element.STATE_HURT_LEFT=19,Element.STATE_HURT_RIGHT=20,Element.STATE_HURT_UP=21,Element.STATE_HURT_DOWN=22,Element.STATE_DEATH=23,Element.STATE_DEATH_LEFT=24,Element.STATE_DEATH_RIGHT=25,Element.STATE_DEATH_UP=26,Element.STATE_DEATH_DOWN=27,Element.prototype.move= function(){0.05>Math.abs(this.hspeed)&&(this.hspeed=0);0.05>Math.abs(this.vspeed)&&(this.vspeed=0);this.x+=this.hspeed;this.vspeed+=this.gravity;this.y+=this.vspeed;if(this.collideSolid){var a=this.sprite.getMask(),b=Game.placeIsFree(this.x+a.x,this.y+a.y,a.width,a.height),b=!0===b?!0:1<b.length?b:b[0].id==this.id?!0:b;if(!0!==b){var c=this.getDirection();if(0<c)for(var c=360==c?Element.STATE_MOVE_RIGHT:90==c?Element.STATE_MOVE_UP:180==c?Element.STATE_MOVE_LEFT:270==c?Element.STATE_MOVE_DOWN:0<c&& 90>c?Element.STATE_MOVE_UP_RIGHT:90<c&&180>c?Element.STATE_MOVE_UP_LEFT:180<c&&270>c?Element.STATE_MOVE_DOWN_LEFT:Element.STATE_MOVE_DOWN_RIGHT,g=this.yprev+a.y;!0!==b;){b=1<b.length?this.instanceNearest(Element,a.x,a.y,b):b[0];if(b.id==this.id)break;var d=b.sprite.getMask();this.eventCollisionWith(b);b.eventCollisionWith(this);c==Element.STATE_MOVE_RIGHT?this.x=b.x+d.x-a.x-a.width:c==Element.STATE_MOVE_UP?this.y=b.y+d.y+d.height-a.y:c==Element.STATE_MOVE_LEFT?this.x=b.x+d.x+d.width-a.x:c==Element.STATE_MOVE_DOWN? this.y=b.y+d.y-a.y-a.height:c==Element.STATE_MOVE_UP_RIGHT?g>=b.y+d.y+d.height?this.y=b.y+d.y+d.height-a.y:this.x=b.x+d.x-a.x-a.width:c==Element.STATE_MOVE_UP_LEFT?g>=b.y+d.y+d.height?this.y=b.y+d.y+d.height-a.y:this.x=b.x+d.x+d.width-a.x:c==Element.STATE_MOVE_DOWN_LEFT?g+a.height<=b.y+d.y?this.y=b.y+d.y-a.y-a.height:this.x=b.x+d.x+d.width-a.x:c==Element.STATE_MOVE_DOWN_RIGHT&&(g+a.height<=b.y+d.y?this.y=b.y+d.y-a.y-a.height:this.x=b.x+d.x-a.x-a.width);b=Game.placeIsFree(this.x+a.x,this.y+a.y,a.width, a.height);b=!0===b?!0:1<b.length?b:b[0].id==this.id?!0:b}else{a=0;for(c=b.length;a<c;a++)this.eventCollisionWith(b[a]),b[a].eventCollisionWith(this)}}}},Element.prototype.display=function(){if(this.active&&this.visible){var a=0,b=0;if(null!=this.sprite.src&&this.sprite.src.complete){if(this.sprite.isTiles)var c=this.sprite.getImage(),a=parseInt(c[0],10),b=parseInt(c[1],10);var g=this.x-Game.room.view_x,d=this.y-Game.room.view_y,h=0<this.rotate;Game.contextBuffer.globalAlpha=(this.opacity/100).toFixed(1); h&&(Game.contextBuffer.save(),Game.contextBuffer.translate(this.centerRotateX,this.centerRotateY),Game.contextBuffer.rotate((360-this.rotate)*Math.PI/180));Game.contextBuffer.drawImage(this.sprite.src,a,b,this.sprite.width,this.sprite.height,Math.round(g-this.centerRotateX),Math.round(d-this.centerRotateY),this.sprite.width*this.sprite.stretchX,this.sprite.height*this.sprite.stretchY);h&&Game.contextBuffer.restore()}g=this.draws.length;for(d=0;d<g;d++)switch(this.draws[d].opacity&&(Game.contextBuffer.globalAlpha= (this.draws[d].opacity/100).toFixed(1)),this.draws[d].color&&"filter"!=this.draws[d].type&&(Game.contextBuffer.fillStyle=this.draws[d].color),this.draws[d].borderLength&&(Game.contextBuffer.lineWidth=this.draws[d].borderLength),this.draws[d].borderColor&&(Game.contextBuffer.strokeStyle=this.draws[d].borderColor),this.draws[d].type){case "text":for(var c=Game.getLinesOfText(this.draws[d]),j=c.length,e=0;e<j;e++)0<this.draws[d].borderLength&&Game.contextBuffer.strokeText(c[e],this.draws[d].x,this.draws[d].y+ e*this.draws[d].lineHeight),Game.contextBuffer.fillText(c[e],this.draws[d].x,this.draws[d].y+e*this.draws[d].lineHeight);break;case "rectangle":Game.contextBuffer.fillRect(this.draws[d].x,this.draws[d].y,this.draws[d].width,this.draws[d].height);0<this.draws[d].borderLength&&Game.contextBuffer.strokeRect(this.draws[d].x,this.draws[d].y,this.draws[d].width,this.draws[d].height);break;case "circle":Game.contextBuffer.beginPath();Game.contextBuffer.arc(this.draws[d].x,this.draws[d].y,this.draws[d].radius, 0,360,!1);Game.contextBuffer.fill();0<this.draws[d].borderLength&&Game.contextBuffer.stroke();break;case "shape":Game.contextBuffer.beginPath();Game.contextBuffer.moveTo(this.draws[d].points[0].x,this.draws[d].points[1].y);e=1;for(c=this.draws[d].points.length;e<c;e++)Game.contextBuffer.lineTo(this.draws[d].points[e].x,this.draws[d].points[e].y);this.draws[d].close&&Game.contextBuffer.closePath();Game.contextBuffer.fill();0<this.draws[d].borderLength&&Game.contextBuffer.stroke();break;case "image":this.draws[d].sprite.changeImage(); c=this.draws[d].sprite.getImage();e=parseInt(c[0],10);c=parseInt(c[1],10);if(j=0<this.draws[d].rotate)Game.contextBuffer.save(),Game.contextBuffer.translate(this.draws[d].centerRotateX,this.draws[d].centerRotateY),Game.contextBuffer.rotate((360-this.draws[d].rotate)*Math.PI/180);Game.contextBuffer.drawImage(this.draws[d].sprite.src,e,c,this.draws[d].sprite.width,this.draws[d].sprite.height,this.draws[d].x-this.draws[d].centerRotateX,this.draws[d].y-this.draws[d].centerRotateY,this.draws[d].sprite.width* this.draws[d].sprite.stretchX,this.draws[d].sprite.height*this.draws[d].sprite.stretchY);j&&Game.contextBuffer.restore();break;case "filter":var c=Element.canvasFilter,j=Element.contextFilter,k=this.draws[d].sprite;c.width=k.width*k.stretchX;c.height=k.height*k.stretchY;h&&(j.save(),j.translate(this.centerRotateX,this.centerRotateY),j.rotate((360-this.rotate)*Math.PI/180));j.drawImage(k.src,a,b,k.width,k.height,Math.round(-this.centerRotateX),Math.round(-this.centerRotateY),k.width*k.stretchX,k.height* k.stretchY);h&&j.restore();for(var f=j.getImageData(0,0,c.width,c.height),e=0,n=f.data.length;e<n;e+=4)if(0<f.data[e+3])switch(this.draws[d].mode){case "multiply":f.data[e]*=this.draws[d].color[0]/255;f.data[e+1]*=this.draws[d].color[1]/255;f.data[e+2]*=this.draws[d].color[2]/255;break;case "divide":f.data[e]=Math.min(255,256*f.data[e]/(this.draws[d].color[0]+1));f.data[e+1]=Math.min(255,256*f.data[e+1]/(this.draws[d].color[1]+1));f.data[e+2]=Math.min(255,256*f.data[e+2]/(this.draws[d].color[2]+1)); break;case "screen":f.data[e]=255-(255-this.draws[d].color[0])*(255-f.data[e])/255;f.data[e+1]=255-(255-this.draws[d].color[1])*(255-f.data[e+1])/255;f.data[e+2]=255-(255-this.draws[d].color[2])*(255-f.data[e+2])/255;break;case "overlay":f.data[e]=f.data[e]/255*(f.data[e]+2*this.draws[d].color[0]/255*(255-f.data[e]));f.data[e+1]=f.data[e+1]/255*(f.data[e+1]+2*this.draws[d].color[1]/255*(255-f.data[e+1]));f.data[e+2]=f.data[e+2]/255*(f.data[e+2]+2*this.draws[d].color[2]/255*(255-f.data[e+2]));break; case "dodge":f.data[e]=Math.min(255,256*f.data[e]/(255-this.draws[d].color[0]+1));f.data[e+1]=Math.min(255,256*f.data[e+1]/(255-this.draws[d].color[1]+1));f.data[e+2]=Math.min(255,256*f.data[e+2]/(255-this.draws[d].color[2]+1));break;case "burn":f.data[e]=Math.max(0,255-256*(255-f.data[e])/(this.draws[d].color[0]+1));f.data[e+1]=Math.max(0,255-256*(255-f.data[e+1])/(this.draws[d].color[1]+1));f.data[e+2]=Math.max(0,255-256*(255-f.data[e+2])/(this.draws[d].color[2]+1));break;case "hard_light":var l= 128<this.draws[d].color[0]?255-(255-2*(this.draws[d].color[0]-128))*(255-f.data[e])/256:Math.min(255,2*this.draws[d].color[0]*f.data[e]/256),m=128<this.draws[d].color[1]?255-(255-2*(this.draws[d].color[1]-128))*(255-f.data[e+1])/256:Math.min(255,2*this.draws[d].color[1]*f.data[e+1]/256),p=128<this.draws[d].color[2]?255-(255-2*(this.draws[d].color[2]-128))*(255-f.data[e+2])/256:Math.min(255,2*this.draws[d].color[2]*f.data[e+2]/256);f.data[e]=l;f.data[e+1]=m;f.data[e+2]=p;break;case "grain_extract":l= Math.max(0,f.data[e]-this.draws[d].color[0]+128);m=Math.max(0,f.data[e+1]-this.draws[d].color[1]+128);p=Math.max(0,f.data[e+2]-this.draws[d].color[2]+128);f.data[e]=Math.min(255,l);f.data[e+1]=Math.min(255,m);f.data[e+2]=Math.min(255,p);break;case "grain_merge":l=Math.max(0,f.data[e]+this.draws[d].color[0]-128);m=Math.max(0,f.data[e+1]+this.draws[d].color[1]-128);p=Math.max(0,f.data[e+2]+this.draws[d].color[2]-128);f.data[e]=Math.min(255,l);f.data[e+1]=Math.min(255,m);f.data[e+2]=Math.min(255,p); break;case "average":l=(f.data[e]+this.draws[d].color[0])/2;m=(f.data[e+1]+this.draws[d].color[1])/2;p=(f.data[e+2]+this.draws[d].color[2])/2;f.data[e]=l;f.data[e+1]=m;f.data[e+2]=p;break;case "difference":f.data[e]=Math.abs(f.data[e]-this.draws[d].color[0]);f.data[e+1]=Math.abs(f.data[e+1]-this.draws[d].color[1]);f.data[e+2]=Math.abs(f.data[e+2]-this.draws[d].color[2]);break;case "addition":f.data[e]=Math.min(255,f.data[e]+this.draws[d].color[0]);f.data[e+1]=Math.min(255,f.data[e+1]+this.draws[d].color[1]); f.data[e+2]=Math.min(255,f.data[e+2]+this.draws[d].color[2]);break;case "substract":f.data[e]=Math.max(0,f.data[e]-this.draws[d].color[0]);f.data[e+1]=Math.max(0,f.data[e+1]-this.draws[d].color[1]);f.data[e+2]=Math.max(0,f.data[e+2]-this.draws[d].color[2]);break;case "darken_only":f.data[e]=Math.min(f.data[e],this.draws[d].color[0]);f.data[e+1]=Math.min(f.data[e+1],this.draws[d].color[1]);f.data[e+2]=Math.min(f.data[e+2],this.draws[d].color[2]);break;case "lighten_only":f.data[e]=Math.max(f.data[e], this.draws[d].color[0]);f.data[e+1]=Math.max(f.data[e+1],this.draws[d].color[1]);f.data[e+2]=Math.max(f.data[e+2],this.draws[d].color[2]);break;default:f.data[e]=this.draws[d].color[0],f.data[e+1]=this.draws[d].color[1],f.data[e+2]=this.draws[d].color[2]}j.putImageData(f,0,0);Game.contextBuffer.drawImage(c,0,0,k.width,k.height,Math.round(this.draws[d].x-this.centerRotateX),Math.round(this.draws[d].y-this.centerRotateY),k.width*k.stretchX,k.height*k.stretchY)}this.draws=[]}},Element.prototype.switchPositionWhenOutsideRoom= function(){this.x>=Game.room.width&&this.x>this.xprev?this.x=-(this.sprite.width/2):0>=this.x&&this.x<this.xprev?this.x=Game.room.width-this.sprite.width/2:0>=this.y&&this.y<this.yprev?this.y=Game.room.height+this.sprite.height/2:this.y>=Game.room.height&&this.y>this.yprev&&(this.y=-(this.sprite.height/2))},Element.prototype.checkCollisions=function(){for(var a=[],b=null,c=null,g=null,d=null,h=null,g=[],j=h=d=null,e=null,e=[],k=this.sprite.getMask(),f=0,n=Game.activeElements.length;f<n;f++)if(b=Game.activeElements[f], b.id!=this.id&&(e=b.sprite.getMask(),b.id!=this.id&&!b.solid&&b.checkForCollisions))if((0==this.rotate||360==this.rotate)&&(0==b.rotate||360==b.rotate)){var d=Math.round(1E3*this.x),h=Math.round(1E3*this.y),j=Math.round(1E3*b.x),l=Math.round(1E3*b.y);thisMaskx=1E3*k.x;thisMasky=1E3*k.y;otherMaskx=1E3*e.x;otherMasky=1E3*e.y;d+thisMaskx>=j+otherMaskx+1E3*e.width||(d+thisMaskx+1E3*k.width<=j+otherMaskx||h+thisMasky>=l+otherMasky+1E3*e.height||h+thisMasky+1E3*k.height<=l+otherMasky)||a.push(b)}else{null== c&&(c=Game.getPointAfterRotation({x:this.x+k.x,y:this.y+k.y},this.rotate,{x:this.centerRotateX,y:this.centerRotateY}),g=Game.getPointAfterRotation({x:this.x+k.x+k.width,y:this.y+k.y},this.rotate,{x:this.centerRotateX,y:this.centerRotateY}),d=Game.getPointAfterRotation({x:this.x+k.x+k.width,y:this.y+k.y+k.height},this.rotate,{x:this.centerRotateX,y:this.centerRotateY}),h=Game.getPointAfterRotation({x:this.x+k.x,y:this.y+k.y+k.height},this.rotate,{x:this.centerRotateX,y:this.centerRotateY}),g=[{start:c, end:g},{start:g,end:d},{start:d,end:h},{start:h,end:c}]);d=Game.getPointAfterRotation({x:b.x+e.x,y:b.y+e.y},b.rotate,{x:b.centerRotateX,y:b.centerRotateY});h=Game.getPointAfterRotation({x:b.x+e.x+e.width,y:b.y+e.y},b.rotate,{x:b.centerRotateX,y:b.centerRotateY});j=Game.getPointAfterRotation({x:b.x+e.x+e.width,y:b.y+e.y+e.height},b.rotate,{x:b.centerRotateX,y:b.centerRotateY});e=Game.getPointAfterRotation({x:b.x+e.x,y:b.y+e.y+e.height},b.rotate,{x:b.centerRotateX,y:b.centerRotateY});e=[{start:d,end:h}, {start:h,end:j},{start:j,end:e},{start:e,end:d}];d=0;a:for(;4>d;d++)for(h=0;4>h;h++)if(Game.segmentsAreInCollision(g[d],e[h])){a.push(b);continue a}}return a},Element.prototype.instanceNearest=function(a,b,c,g){for(var g=void 0==g?Game.activeElements:g,d=null,h=-1,j=0,b=void 0==b?0:b,c=void 0==c?0:c,e=0,k=g.length;e<k;e++){var f=g[e];if(f.instanceOf(a)&&f.id!=this.id&&(j=Game.getDistanceBetweenPoints([f.x,f.y],[this.x+b,this.y+c]),0>h||j<h))h=j,d=f}return d},Element.prototype.setActive=function(a){if(!a&& this.active){this.active=!1;for(var a=0,b=Game.activeElements.length;a<b;a++)if(Game.activeElements[a].id==this.id){Game.activeElements.splice(a,1);break}}else a&&!this.active&&(this.active=!0,Game.activeElements.push(this))},Element.prototype.getDirection=function(){var a=0;0!=this.hspeed&&0!=this.vspeed?(a=180*Math.abs(Math.atan(this.vspeed/this.hspeed))/Math.PI,a=0>this.hspeed&&0>this.vspeed?180-a:0<this.hspeed&&0<this.vspeed?360-a:0>this.hspeed?180+a:a):a=0==this.hspeed?0<this.vspeed?270:0>this.vspeed? 90:0:0==this.vspeed?0>this.hspeed?180:360:0;return Math.round(a)},Element.prototype.getSpeed=function(){return parseFloat(parseFloat(Math.sqrt(Math.pow(this.hspeed,2)+Math.pow(this.vspeed,2))).toFixed(2))},Element.prototype.moveToDirection=function(a,b){a=(360-a)*(Math.PI/180);this.vspeed=b*Math.sin(a);this.hspeed=b*Math.cos(a)},Element.prototype.moveToPoint=function(a,b,c,g){var d=a-this.x,h=b-this.y;Math.abs(d);Math.abs(h);var j=0;void 0!=g&&(this.moveToPointCallBack={x:a,y:b,fromLeft:0<d,fromTop:0< h,f:g});0!=d&&0!=h?(j=180*Math.abs(Math.atan(h/d))/Math.PI,j=0>d&&0>h?180-j:0<d&&0<h?360-j:0>d?180+j:j):j=0==d?0<h?270:0>h?90:0:0==h?0>d?180:0:0;this.moveToDirection(j,c)},Element.prototype.setPath=function(a,b,c){if(a[0]){var g=this,d=function(h){g.moveToPoint(a[h][0],a[h][1],b,function(){a[h][2]&&a[h][2].apply(g);if(a[++h])d(h);else if(c)if("string"==typeof c)switch(c){case "repeat":d(0);break;case "reverse":a.reverse(),a.push(a.shift()),d(0)}else c.apply(g)})};d(0)}},Element.prototype.instanceOf= function(a){"string"==typeof a&&(a=window[a]);for(var b=0,c=this.types.length;b<c;b++)if(window[this.types[b]]==a)return!0;return!1},Element.prototype.callParent=function(a,b,c){if(void 0==a)return alert("Erreur <callParent> (M\u00e9thode ["+a+"] appel\u00e9e par ["+this.types+"]) : m\u00e9thode non d\u00e9finie !"),!1;b=void 0==b?[]:b;c=void 0==c?void 0==this.types[1]?this.types[0]:this.types[1]:c;"string"==typeof c&&(c=window[c]);if(this.instanceOf(c))return c.prototype[a].apply(this,b);alert("Erreur <callParent> (M\u00e9thode ["+ a+"] appel\u00e9e par ["+this.types+"]) : l'\u00e9l\u00e9ment appelant n'est pas du type indiqu\u00e9 !");return!1},Element.prototype.setZIndex=function(a){this.zIndex!=a&&(this.zIndex=a,Game.zIndex=!0,a>Game.MAX_ZINDEX&&(Game.MAX_ZINDEX=a))},Element.prototype.getCenter=function(a){return a?(a=this.sprite.getMask(),{x:this.x+a.x+a.width/2,y:this.y+a.y+a.height/2}):{x:this.x+this.sprite.width/2,y:this.y+this.sprite.height/2}},Element.prototype.toFirstPlan=function(){this.setZIndex(++Game.MAX_ZINDEX)}, Element.prototype.setAlarm=function(a,b){1<=a&&10>=a?0<b?this["alarm"+a]=parseInt(33*b,10):alert("Erreur <setAlarm> (Appel\u00e9 par ["+this.types+"]) : le temps sp\u00e9cifi\u00e9 doit \u00eatre sup\u00e9rieur \u00e0 0 seconde !"):alert("Erreur <setAlarm> (Appel\u00e9 par ["+this.types+"]) : le num\u00e9ro de l'alarme doit \u00eatre compris entre 1 et 10 inclus !")},Element.prototype.drawText=function(a){if(0<(a.opacity||100))this.draws.push(Game.mergeJSON({type:"text",x:this.x,y:this.y,color:"#000000", borderLength:0,maxWidth:-1,borderColor:"#ffffff",font:"20px Calibri",opacity:100,lineHeight:20,text:""},void 0==a?{}:a))},Element.prototype.drawRectangle=function(a){if(0<(a.opacity||100))this.draws.push(Game.mergeJSON({type:"rectangle",x:0,y:0,width:100,height:100,color:"#000000",borderLength:0,borderColor:"#ffffff",opacity:100},void 0==a?{}:a))},Element.prototype.drawCollisions=function(a){this.visible||(this.visible=!0,this.opacity=0);var b=this.sprite.getMask(),c={width:b.width,height:b.height}; c.x=this.x+b.x-Game.room.view_x;c.y=this.y+b.y-Game.room.view_y;c.color=void 0==a?"red":a;this.drawRectangle(c)},Element.prototype.drawFilter=function(a){if(0<(a.opacity||100))this.draws.push(Game.mergeJSON({type:"filter",color:[255,0,0],mode:"normal",x:this.x-Game.room.view_x,y:this.y-Game.room.view_y,sprite:this.sprite,opacity:100},void 0==a?{}:a))},Element.prototype.drawCircle=function(a){if(0<(a.opacity||100))this.draws.push(Game.mergeJSON({type:"circle",x:0,y:0,radius:16,color:"#000000",borderLength:0, borderColor:"#ffffff",opacity:100},void 0==a?{}:a))},Element.prototype.drawShape=function(a){if(0<(a.opacity||100))this.draws.push(Game.mergeJSON({type:"shape",points:[],color:"#000000",borderLength:0,borderColor:"#ffffff",close:!0,opacity:100},void 0==a?{}:a))},Element.prototype.drawSprite=function(a){var b=a.opacity||100;json=Game.mergeJSON({type:"image",x:0,y:0,rotate:0,centerRotateX:0,centerRotateY:0,sprite:null,filter:null,opacity:100},void 0==a?{}:a);0<b&&a.sprite&&this.draws.push(json);json.filter&& (json.filter.sprite=json.sprite,json.filter.x=json.x,json.filter.y=json.y,this.drawFilter(json.filter))},Element.prototype.isMouseOver=function(){var a=Game.getMouse(!1),b=this.sprite.getMask();return!(this.x+b.x>a[0]||this.x+b.x+b.width<a[0]||this.y+b.y>a[1]||this.y+b.y+b.height<a[1])},Element.prototype.eventCreate=function(){},Element.prototype.eventOutsideRoom=function(){},Element.prototype.eventOutsideView=function(){},Element.prototype.eventInsideView=function(){},Element.prototype.eventRoomStart= function(){},Element.prototype.eventDestroy=function(){},Element.prototype.eventStartStep=function(){},Element.prototype.eventStep=function(){},Element.prototype.eventEndStep=function(){},Element.prototype.eventCollisionWith=function(){},Element.prototype.eventMouseDown=function(){},Element.prototype.eventMouseUp=function(){},Element.prototype.eventClick=function(){},Element.prototype.eventKeyDown=function(){},Element.prototype.eventKeyPressed=function(){},Element.prototype.eventKeyUp=function(){}, Element.prototype.eventEndAnimation=function(){},Element.prototype.eventAlarm1=function(){},Element.prototype.eventAlarm2=function(){},Element.prototype.eventAlarm3=function(){},Element.prototype.eventAlarm4=function(){},Element.prototype.eventAlarm5=function(){},Element.prototype.eventAlarm6=function(){},Element.prototype.eventAlarm7=function(){},Element.prototype.eventAlarm8=function(){},Element.prototype.eventAlarm9=function(){},Element.prototype.eventAlarm10=function(){})} function Sprite(a,b,c){this.src=a;this.width=void 0==b?this.src.width:b;this.height=void 0==c?this.src.height:c;this.stretchY=this.stretchX=1;this.isTiles=!1;this.tilesSheet=[[]];this.tiles=[];this.imagespeed=0.3;this.imageindex=0;this.masks={};void 0==Sprite.isLoaded&&(Sprite.isLoaded=!0,Sprite.prototype.changeImage=function(){if(this.isTiles){var a=parseInt(this.imageindex,10);this.imageindex+=this.imagespeed;if(this.imageindex>this.tiles.length)return this.imageindex=0,!0;parseInt(this.imageindex, 10)>a&&(this.imageindex=a+1)}return!1},Sprite.prototype.getImage=function(){var a=void 0==this.imageindex?0:parseInt(this.imageindex,10);a>this.tiles.length&&(a=0);var a=this.tiles[a],b=0;if(void 0==a)return[0,0];for(var c in this.tilesSheet)for(var j in this.tilesSheet[c])if(b++,b==a)return this.tilesSheet[c][j]},Sprite.prototype.makeTiles=function(a,b,c){this.isTiles=!0;for(var c=void 0==c?0:c,j=this.height,e=this.width,k=0;k<j;k+=b){this.tilesSheet[k/b]=[];for(var f=0;f<e;f+=a)this.tilesSheet[k/ b][f/a]=[f+c*(f/a),k+c*(k/b)],e-=c;e=this.width;j-=c}this.width=a;this.height=b;this.tiles=[1]},Sprite.prototype.getTile=function(){var a=this.tiles[parseInt(this.imageindex,10)];return void 0==a?void 0==this.tiles[0]?1:this.tiles[0]:a},Sprite.prototype.setMask=function(a,b){this.masks[a]=Game.mergeJSON({x:0,y:0,width:16,height:16},void 0==b?{}:b)},Sprite.prototype.getMask=function(){var a=this.masks[this.getTile()],b={x:0,y:0,width:this.width,height:this.height};return void 0==a?b:Game.mergeJSON(b, a)})} function Room(a,b,c){this.path=null;"string"==typeof a&&(this.path=a,b=a=0);this.xml=null;this.id=0;this.width=a;this.height=b;this.view_y=this.view_x=0;this.view_w=a;this.view_h=b;this.viewLink=null;this.viewHasMoved=!1;this.background_vspeed=this.background_hspeed=1;this.tiles=[];this.backgroundImage=c;this.background=new Image;void 0==Room.isLoaded&&(Room.isLoaded=!0,Room.prototype.display=function(){Game.contextBuffer.globalAlpha=1;var a=this.view_x,b=this.view_y;this.background&&void 0==this.background.src.complete&& (this.background=Game.getImage(this.backgroundImage));try{if(null!==this.viewLink||this.viewHasMoved){null!==this.viewLink?(this.viewHasMoved=!0,a=this.viewLink.x+this.viewLink.sprite.width/2-this.view_w/2,b=this.viewLink.y+this.viewLink.sprite.height/2-this.view_h/2,a=0>a?0:a,b=0>b?0:b,a=a+this.view_w>this.width?this.width-this.view_w:a,b=b+this.view_h>this.height?this.height-this.view_h:b,this.view_x=a,this.view_y=b):(a=this.view_x,b=this.view_y);if(this.background)for(var a=a*this.background_hspeed, b=b*this.background_vspeed,c=0;c<this.width*this.background_hspeed;c+=this.background.width)for(var j=0;j<this.height*this.background_vspeed;j+=this.background.height)c>=a-this.background.width&&(c<=a+this.view_w+this.background.width&&j>=b-this.background.height&&j<=b+this.view_h+this.background.height)&&Game.contextBuffer.drawImage(this.background,0,0,this.background.width,this.background.height,c-a,j-b,this.background.width,this.background.height);Game.canvas.style.backgroundPosition="-"+a+"px -"+ b+"px"}else if(this.background)for(c=0;c<this.width;c+=this.background.width)for(j=0;j<this.height;j+=this.background.height)Game.contextBuffer.drawImage(this.background,0,0,this.background.width,this.background.height,c,j,this.background.width,this.background.height)}catch(e){}},Room.prototype.start=function(){Game.changeRoom=!0;Game.currentStep=0;Game.end||(Game.elements.splice(0,Game.elements.length),Game.activeElements.splice(0,Game.activeElements.length));Game.canvas.width=this.view_w;Game.canvas.height= this.view_h;Game.canvas.style.backgroundPosition="center center";Game.canvasBuffer.width=this.view_w;Game.canvasBuffer.height=this.view_h;this.view_y=this.view_x=0;if(null!==this.xml){var a=this.xml.getElementsByTagName("tiles")[0];if(a&&0==this.tiles.length)for(var a=a.childNodes,b="",c=null,j=0,e=0,k=0,f=a.length;k<f;k++)if("#text"!=a[k].nodeName){j=parseInt(a[k].getAttribute("tiles_width"),10);e=parseInt(a[k].getAttribute("tiles_height"),10);b=new Sprite(Game.getImage(a[k].getAttribute("src"))); b.makeTiles(j,e,parseInt(a[k].getAttribute("sep"),10));var c=a[k].getElementsByTagName("zIndex")[0],n={};if(c)for(var c=c.getElementsByTagName("z"),l=0,m=c.length;l<m;l++)n[parseInt(c[l].getAttribute("num"),10)]=parseInt(c[l].getAttribute("value"),10);c=a[k].getElementsByTagName("tile");l=0;for(m=c.length;l<m;l++){var p=parseInt(c[l].textContent||c[l].firstChild.nodeValue);b.tiles=[p];var q=b.getImage();this.tiles.push({image:b.src,posXImage:parseInt(q[0],10),posYImage:parseInt(q[1],10),w:j,h:e,x:c[l].getAttribute("x"), y:c[l].getAttribute("y"),zIndex:n[p]||0})}}c=this.xml.getElementsByTagName("element");k=0;for(f=c.length;k<f;k++)b=c[k].textContent||c[k].firstChild.nodeValue,Game.instanceCreate(c[k].getAttribute("x"),c[k].getAttribute("y"),b)}this.eventStart();k=0;for(a=Game.activeElements.length;k<a;k++)Game.activeElements[k].eventRoomStart();Game.isFullscreen&&Game.backgroundResizeHandler()},Room.prototype.setView=function(a,b,c,j){this.view_w=a;this.view_h=b;this.view_x=void 0==c?this.view_x:c;this.view_y=void 0== j?this.view_y:j;Game.canvas&&(Game.canvas.width=this.view_w,Game.canvas.height=this.view_h,Game.canvasBuffer.width=this.view_w,Game.canvasBuffer.height=this.view_h,document.getElementById("infoGameBuilder").style.width=this.view_w+"px")},Room.prototype.eventStart=function(){},Room.prototype.eventEnd=function(){})};