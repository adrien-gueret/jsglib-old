{"version":3,"sources":["../../jsglib/layer.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;sBA4Ee,KAAK","file":"layer.js","sourcesContent":["\"use strict\";\r\n\r\nclass Layer {\r\n    constructor(name) {\r\n        this.name = name;\r\n\r\n        this.canvas = document.createElement('canvas');\r\n        this.ctx = this.canvas.getContext('2d');\r\n        this.canvas.setAttribute('data-name', this.name);\r\n        this.canvas.style.position = 'absolute';\r\n        this.canvas.style.left = 0;\r\n        this.canvas.style.top = 0;\r\n        this.canvas.style.zIndex = 0;\r\n\r\n        this.tiles_sprite = null;\r\n        this.tiles = [];\r\n    }\r\n\r\n    setSize(width, height) {\r\n        this.canvas.width = width;\r\n        this.canvas.height = height;\r\n        return this;\r\n    }\r\n\r\n    setZindex(new_zindex) {\r\n        this.canvas.style.zIndex = new_zindex;\r\n        return this;\r\n    }\r\n\r\n    getTileFromPoint(point) {\r\n        if (!this.tiles_sprite) {\r\n            return null;\r\n        }\r\n\r\n        let tiles_size = this.tiles_sprite.getTilesSize();\r\n        let row = this.tiles[Math.floor(point.y / tiles_size.height)];\r\n\r\n        if (!row) {\r\n            return null;\r\n        }\r\n\r\n        return row[Math.floor(point.x / tiles_size.width)] || null;\r\n    }\r\n\r\n    draw(timer, force_redraw = false) {\r\n        this.tiles.forEach((row, row_index) => {\r\n            row.forEach((tile, column_index) => {\r\n                // Draw tile only if we need it\r\n                if (!force_redraw && !tile.needs_redraw) {\r\n                    return;\r\n                }\r\n\r\n                tile.needs_redraw = false;\r\n                tile.clear(this.ctx, column_index, row_index);\r\n\r\n                // If empty tile, we skip it\r\n                if (tile.is_empty) {\r\n                    return;\r\n                }\r\n\r\n                tile.draw(this.ctx, column_index, row_index, timer);\r\n            });\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    clear() {\r\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n        return this;\r\n    }\r\n}\r\nLayer.MAIN_LAYER = new Layer('MAIN_LAYER');\r\nLayer.TILES_LAYER = new Layer('TILES_LAYER');\r\nLayer.BACKGROUND_LAYER = new Layer('BACKGROUND_LAYER');\r\n\r\nexport default Layer;"]}