{"version":3,"sources":["../../jsglib/tile.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;sBAyGe,IAAI","file":"tile.js","sourcesContent":["\"use strict\";\r\n\r\nimport EventsHandler from \"jsglib/events_handler\";\r\nimport Point from \"jsglib/point\";\r\n\r\nclass Tile extends EventsHandler {\r\n    constructor(sprite_class, x = 0, y = 0, tile_number = 0) {\r\n        super();\r\n\r\n        this.sprite_class = sprite_class;\r\n        this.position = new Point(x, y);\r\n        this.tile_number = tile_number;\r\n        this.needs_redraw = true;\r\n        this.clock_animation = null;\r\n        this.is_empty = false;\r\n    }\r\n\r\n    static getNewEmptyTile(sprite_class) {\r\n        let tile = new Tile(sprite_class);\r\n        tile.is_empty = true;\r\n        return tile;\r\n    }\r\n\r\n    clone() {\r\n        let new_tile = new Tile(this.sprite_class, this.position.x, this.position.y, this.tile_number);\r\n\r\n        if (this.animation) {\r\n            let {next_tile_number, time} = this.animation;\r\n            new_tile.animation = {next_tile_number, time};\r\n        }\r\n\r\n        return new_tile;\r\n    }\r\n\r\n    setTileNumber(tile_number) {\r\n        this.trigger('clear_animation');\r\n\r\n        let tile = this.sprite_class.getTile(tile_number);\r\n        this.is_empty = tile.is_empty;\r\n        this.tile_number = tile_number;\r\n        this.position = tile.position;\r\n        this.animation = tile.animation;\r\n        this.needs_redraw = true;\r\n\r\n        return this;\r\n    }\r\n\r\n    draw(ctx, x = 0, y = 0, timer) {\r\n        let tiles_size = {\r\n            width: this.sprite_class.tiles_width,\r\n            height: this.sprite_class.tiles_height\r\n        };\r\n\r\n        let dest_x = x * tiles_size.height;\r\n        let dest_y = y * tiles_size.width;\r\n\r\n        ctx.drawImage(\r\n            this.sprite_class.image,\r\n            this.position.x,\r\n            this.position.y,\r\n            tiles_size.width,\r\n            tiles_size.height,\r\n            dest_x,\r\n            dest_y,\r\n            tiles_size.width,\r\n            tiles_size.height\r\n        );\r\n\r\n        if (this.animation) {\r\n            this.trigger('clear_animation');\r\n\r\n            this.clock_animation = timer.setTimeout(() => {\r\n                this.setTileNumber(this.animation.next_tile_number);\r\n            }, this.animation.time);\r\n\r\n            this.off('clear_animation').on('clear_animation', () => {\r\n                if (this.clock_animation) {\r\n                    timer.clearTimeout(this.clock_animation);\r\n                    this.clock_animation = null;\r\n                }\r\n            });\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    clear(ctx, x, y) {\r\n        let tiles_size = {\r\n            width: this.sprite_class.tiles_width,\r\n            height: this.sprite_class.tiles_height\r\n        };\r\n\r\n        let dest_x = x * tiles_size.height;\r\n        let dest_y = y * tiles_size.width;\r\n\r\n        ctx.clearRect(dest_x, dest_y, tiles_size.width, tiles_size.height);\r\n        return this;\r\n    }\r\n\r\n    setAnimation(next_tile_number, time) {\r\n        this.animation = {next_tile_number, time};\r\n        return this;\r\n    }\r\n}\r\n\r\nexport default Tile;"]}