{"version":3,"sources":["../../jsglib/game.js"],"names":[],"mappings":"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","file":"game.js","sourcesContent":["(function(window, undefined) {\r\n    \"use strict\";\r\n\r\n    let JSGlib = window.JSGlib || {};\r\n\r\n    class Game {\r\n        constructor(game_container, layers = [\r\n\t\t\tJSGlib.Layer.MAIN_LAYER,\r\n\t\t\tJSGlib.Layer.TILES_LAYER,\r\n\t\t\tJSGlib.Layer.BACKGROUND_LAYER\r\n\t\t]) {\r\n            this.container = game_container;\r\n\t\t\tthis.current_room = null;\r\n\t\t\tthis.classes = {};\r\n\t\t\tthis.timer = new JSGlib.Timer();\r\n\r\n\t\t\tthis.defineLayers(layers);\r\n        }\r\n        defineLayers(layers) {\r\n\t\t\tthis.layers = {};\r\n\r\n\t\t\tlayers.forEach((layer, key) => {\r\n\t\t\t\tlayer.setZindex(key);\r\n\t\t\t\tthis.layers[layer.name] = layer;\r\n\t\t\t\tthis.container.appendChild(layer.canvas);\r\n\t\t\t});\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tgetLayerFromName(layer_name) {\r\n\t\t\treturn this.layers[layer_name];\r\n\t\t}\r\n\t\tregisterClass(new_class) {\r\n\t\t\tthis.classes[new_class.name] = new_class;\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tgetClass(class_name) {\r\n\t\t\tif (typeof class_name === 'function') {\r\n\t\t\t\treturn class_name;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.classes[class_name]) {\r\n\t\t\t\treturn this.classes[class_name];\r\n\t\t\t}\r\n\r\n\t\t\treturn window[class_name];\r\n\t\t}\r\n\t\tstart() {\r\n\t\t\tthis.last_loop_time = Date.now();\r\n\t\t\tthis.loop();\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tloop() {\r\n\t\t\twindow.requestAnimationFrame(this.loop.bind(this));\r\n\r\n\t\t\tlet now = Date.now();\r\n\t\t\tlet delta = now - this.last_loop_time;\r\n\t\t\tlet interval = 1000 / this.timer.fps;\r\n\r\n\t\t\tif (delta <= interval) {\r\n\t\t\t\tthis.timer.trigger('step');\r\n\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\r\n\t\t\tthis.render();\r\n\r\n\t\t\tthis.last_loop_time = now - (delta % interval);\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\trender() {\r\n\t\t\tif (!this.layers) {\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\r\n\t\t\tfor (let layer_name in this.layers) {\r\n\t\t\t\tthis.layers[layer_name].draw(this.timer);\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tgoToRoom(level) {\r\n\t\t\tthis.current_room = level;\r\n\t\t\tlevel.initRoom(this);\r\n\r\n\t\t\tthis.container.style.width = level.width + 'px';\r\n\t\t\tthis.container.style.height = level.height + 'px';\r\n\r\n\t\t\tfor (let layer_name in this.layers) {\r\n\t\t\t\tlet layer = this.layers[layer_name];\r\n\t\t\t\tlayer.setSize(level.width, level.height);\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n    }\r\n\r\n\tJSGlib.Game = Game;\r\n\r\n\twindow.JSGlib = JSGlib;\r\n})(window);"]}