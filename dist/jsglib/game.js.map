{"version":3,"sources":["../../jsglib/game.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;KAKqB,IAAI;WAAJ,IAAI;;;;yBAAJ,IAAI;;;;;;;;;eAAJ,IAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;SAAJ,IAAI;;;mBAAJ,IAAI","file":"game.js","sourcesContent":["\"use strict\";\r\n\r\nimport Layer from 'jsglib/layer';\r\nimport Timer from 'jsglib/timer';\r\n\r\nexport default class Game {\r\n\tconstructor(game_container, layers = [\r\n\t\tLayer.MAIN_LAYER,\r\n\t\tLayer.TILES_LAYER,\r\n\t\tLayer.BACKGROUND_LAYER\r\n\t], fps = 30) {\r\n\t\tthis.container = game_container;\r\n\t\tthis.current_room = null;\r\n\t\tthis.classes = {};\r\n\t\tthis.timer = new Timer(fps);\r\n\r\n\t\tthis.defineLayers(layers);\r\n\t}\r\n\tdefineLayers(layers) {\r\n\t\tthis.layers = {};\r\n\r\n\t\tlayers.forEach((layer, key) => {\r\n\t\t\tlayer.setZindex(key);\r\n\t\t\tthis.layers[layer.name] = layer;\r\n\t\t\tthis.container.appendChild(layer.canvas);\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n\tgetLayerFromName(layer_name) {\r\n\t\treturn this.layers[layer_name];\r\n\t}\r\n\tregisterClass(new_class) {\r\n\t\tthis.classes[new_class.name] = new_class;\r\n\t\treturn this;\r\n\t}\r\n\tgetClass(class_name) {\r\n\t\tif (typeof class_name === 'function') {\r\n\t\t\treturn class_name;\r\n\t\t}\r\n\r\n\t\tif (this.classes[class_name]) {\r\n\t\t\treturn this.classes[class_name];\r\n\t\t}\r\n\r\n\t\treturn window[class_name];\r\n\t}\r\n\tstart() {\r\n\t\tthis.last_loop_time = Date.now();\r\n\t\tthis.loop();\r\n\t\treturn this;\r\n\t}\r\n\tloop() {\r\n\t\twindow.requestAnimationFrame(this.loop.bind(this));\r\n\r\n\t\tlet now = Date.now();\r\n\t\tlet delta = now - this.last_loop_time;\r\n\t\tlet interval = 1000 / this.timer.fps;\r\n\r\n\t\tif (delta <= interval) {\r\n\t\t\tthis.timer.trigger('step');\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tthis.render();\r\n\r\n\t\tthis.last_loop_time = now - (delta % interval);\r\n\r\n\t\treturn this;\r\n\t}\r\n\trender() {\r\n\t\tif (!this.layers) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tfor (let layer_name in this.layers) {\r\n\t\t\tthis.layers[layer_name].draw(this.timer);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\tgoToRoom(level) {\r\n\t\tthis.current_room = level;\r\n\t\tlevel.initRoom(this);\r\n\r\n\t\tthis.container.style.width = level.width + 'px';\r\n\t\tthis.container.style.height = level.height + 'px';\r\n\r\n\t\tfor (let layer_name in this.layers) {\r\n\t\t\tlet layer = this.layers[layer_name];\r\n\t\t\tlayer.setSize(level.width, level.height);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n}"]}